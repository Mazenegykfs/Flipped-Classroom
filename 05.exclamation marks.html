<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson: Using Exclamation Marks in Technical Writing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e0f7fa; /* Light Blue Background */
        }
        .header {
            background-color: #00897B; /* Brighter Teal Header */
            color: white;
            padding: 1rem;
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); /* Enhanced Shadow */
        }
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            border: none;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .btn-green {
            background-color: #4CAF50; /* Green for accept/execute */
            color: white;
        }
        .btn-green:hover {
            background-color: #45a049;
        }
        .btn-red {
            background-color: #f44336; /* Red for cancel/reset */
            color: white;
        }
        .btn-red:hover {
            background-color: #e53935;
        }
        .btn-home {
            background-color: #004d40;
            color: white;
        }
        .btn-home:hover {
            background-color: #00695c;
        }
        h1, h2, h3 {
            color: #004d40;
        }
        .correct-answer {
            color: #2e7d32;
            font-weight: 600;
            background-color: #e8f5e9;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .incorrect-answer {
            color: #c62828;
            font-weight: 600;
            background-color: #ffebee;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .explanation {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background-color: #eef2ff; /* Light indigo background */
            border-left: 4px solid #4f46e5; /* Indigo border */
            color: #3730a3;
            border-radius: 0.25rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, padding 0.5s ease-out;
        }
        .explanation.show {
            max-height: 100px; /* Adjust as needed */
            padding: 0.75rem;
        }
        /* Drag and Drop Styles */
        .exclamation-draggable {
            display: inline-block;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: grab;
            padding: 0 0.5rem;
            background-color: #c8e6c9;
            border-radius: 50%;
            user-select: none;
        }
        .drop-zone {
            display: inline-block;
            width: 1rem;
            height: 1.5rem;
            background-color: #e0f2f1;
            border: 1px dashed #00796b;
            border-radius: 4px;
            margin: 0 2px;
            transition: background-color 0.3s;
        }
        .drop-zone.drag-over {
            background-color: #a7ffeb;
        }
        .drop-zone.correct {
            border: 2px solid #4CAF50;
            background-color: #e8f5e9;
        }
         .drop-zone.incorrect {
            border: 2px solid #f44336;
            background-color: #ffebee;
        }

        /* --- CHATBOT STYLES --- */
        #chat-modal {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        #chat-modal.visible {
            opacity: 1;
            pointer-events: auto;
        }
        #chat-window::-webkit-scrollbar { width: 8px; }
        #chat-window::-webkit-scrollbar-track { background: #f1f5f9; }
        #chat-window::-webkit-scrollbar-thumb { background-color: #38bdf8; border-radius: 20px; border: 3px solid #f1f5f9; }
        .chat-bubble { max-width: 80%; word-wrap: break-word; }
        .bot-bubble { background-color: #ffffff; border: 1px solid #e2e8f0; }
        .user-bubble { background-color: #dcfce7; align-self: flex-end; }
        .typing-indicator { display: flex; align-items: center; padding: 1rem; }
        .typing-indicator span { height: 10px; width: 10px; margin: 0 2px; background-color: #94a3b8; border-radius: 50%; display: inline-block; animation: bounce 1.4s infinite ease-in-out both; }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
    </style>
</head>
<body>

    <header class="header">
        <span>Using A Technology-Enhanced Flipped Classroom Model to Develop EFL Engineering Students’ Punctuation Marks</span>
        <a href="https://mazenegykfs.github.io/Flipped-Classroom/index.html" class="btn btn-home">Home</a>
    </header>

    <div class="container mx-auto p-4 md:p-8">
        <h1 class="text-3xl md:text-4xl font-bold text-center mb-8">Using Exclamation Marks in Technical Writing</h1>

        <!-- Objectives -->
        <div class="card">
            <h2 class="text-2xl font-bold mb-4">1. Objectives</h2>
            <ul class="list-disc list-inside space-y-2">
                <li>Identify the appropriate use of exclamation marks for warnings and strong commands.</li>
                <li>Understand why exclamation marks should be used sparingly in professional and technical writing.</li>
                <li>Differentiate between an appropriate tone (urgent, cautionary) and an inappropriate tone (overly emotional, unprofessional).</li>
                <li>Avoid using exclamation marks for simple statements of fact or routine information.</li>
            </ul>
        </div>

        <!-- Review & Warm-up -->
        <div class="grid md:grid-cols-2 gap-6">
            <div class="card">
                <h2 class="text-2xl font-bold mb-4">2. Review</h2>
                <p class="mb-2">An <strong>exclamation mark (!)</strong> is a punctuation mark used at the end of a sentence to indicate strong feelings, such as surprise, excitement, or urgency. It replaces a period to add emotional emphasis.</p>
            </div>
            <div class="card">
                <h2 class="text-2xl font-bold mb-4">3. Warm-up</h2>
                <p class="mb-2">How does the punctuation change the professionalism of these sentences?</p>
                <p class="italic">1. The report is attached.</p>
                <p class="italic">2. The report is attached!</p>
                <button id="reveal-warmup-btn" class="btn btn-green mt-2">Reveal Explanation</button>
                <div id="warmup-explanation" class="explanation">
                    Sentence 1 is a neutral, professional statement. Sentence 2 seems overly excited and can be perceived as unprofessional in a formal context. The choice of end punctuation significantly impacts tone.
                </div>
            </div>
        </div>
        
        <!-- Presentation -->
        <div class="card">
            <h2 class="text-2xl font-bold mb-4">4. Presentation: Two Key Exclamation Mark Rules</h2>
            
            <!-- YouTube Video -->
            <div class="my-6">
                <div class="aspect-w-16 aspect-h-12">
                    <iframe class="w-full h-full rounded-lg shadow-lg" src="https://www.youtube.com/embed/jmWxw7ENXZk" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Rule 1 -->
                <div>
                    <h3 class="text-xl font-semibold">Rule 1: Use for Genuine Warnings and Commands</h3>
                    <p class="mt-1">In technical writing, the primary acceptable use of an exclamation mark is for a direct warning, a caution, or a strong command that relates to safety or critical operations.</p>
                    <p class="mt-2 p-3 bg-gray-100 rounded-md"><b>Correct:</b> Warning<span class="font-bold text-blue-700">!</span> High voltage.</p>
                    <p class="mt-2 p-3 bg-gray-100 rounded-md"><b>Correct:</b> Do not touch this surface<span class="font-bold text-blue-700">!</span></p>
                </div>
                <!-- Rule 2 -->
                <div>
                    <h3 class="text-xl font-semibold">Rule 2: Avoid Overuse in Professional Communication</h3>
                    <p class="mt-1">Overusing exclamation marks makes writing seem unprofessional, overly emotional, or even childish. They should be reserved for truly exceptional situations and avoided in routine correspondence and reports.</p>
                    <p class="mt-2 p-3 bg-red-100 rounded-md"><b>Unprofessional:</b> The new software update is finally here<span class="font-bold text-blue-700">!</span> I'm so excited<span class="font-bold text-blue-700">!</span></p>
                    <p class="mt-2 p-3 bg-gray-100 rounded-md"><b>Professional:</b> The new software update has been released.</p>
                </div>
            </div>
        </div>

        <!-- NEW Interactive Practice: Drag & Drop -->
        <div class="card">
            <h2 class="text-2xl font-bold mb-4">5. Interactive Practice: Drag & Drop</h2>
            <div class="flex items-center space-x-4 p-4 bg-gray-100 rounded-lg">
                <p>Drag this exclamation mark:</p>
                <div id="exclamation-bank">
                    <span class="exclamation-draggable" draggable="true">!</span>
                </div>
            </div>
            <div id="drag-drop-sentences" class="mt-4 space-y-4 text-lg">
                <p>1. Danger<span class="drop-zone" data-correct="true"></span> Corrosive material.</p>
                <p>2. The meeting is scheduled for 3 PM<span class="drop-zone" data-correct="false"></span></p>
                <p>3. Stop the machine immediately<span class="drop-zone" data-correct="true"></span></p>
                <p>4. The test results are positive<span class="drop-zone" data-correct="false"></span></p>
            </div>
        </div>

        <!-- Practice -->
        <div class="card">
            <h2 class="text-2xl font-bold mb-4">6. Practice</h2>
            <p class="mb-4">Choose the sentence where the exclamation mark is used most appropriately.</p>
            <div id="practice-section" class="space-y-6">
                <!-- Practice questions will be injected here by JS -->
            </div>
             <div class="mt-4 text-right">
                <button onclick="resetSection('practice-section', practiceQuestions)" class="btn btn-red">Reset</button>
            </div>
        </div>

        <!-- Assessment -->
        <div class="card">
            <h2 class="text-2xl font-bold mb-4">7. Assessment</h2>
            <p class="mb-4">Choose the sentence that uses punctuation most professionally.</p>
            <div id="assessment-section" class="space-y-6">
                 <!-- Assessment questions will be injected here by JS -->
            </div>
             <div class="mt-4 text-right">
                <button onclick="resetSection('assessment-section', assessmentQuestions)" class="btn btn-red">Reset</button>
            </div>
        </div>
        
        <!-- Assignment -->
        <div class="card">
            <h2 class="text-2xl font-bold mb-4">8. Assignment: Final Quiz</h2>
            <p class="mb-4">Choose the sentence where the exclamation mark is used most appropriately.</p>
            <div id="assignment-section" class="space-y-6">
                <!-- Assignment questions will be injected here by JS -->
            </div>
            <div id="assignment-results" class="mt-6 text-xl font-bold text-center"></div>
             <div class="mt-4 text-right">
                <button onclick="resetSection('assignment-section', assignmentQuestions, true)" class="btn btn-red">Reset</button>
            </div>
        </div>

        <!-- Export Worksheet Section -->
        <div class="card text-center">
            <h2 class="text-2xl font-bold mb-4">Download Worksheet</h2>
            <p class="mb-4">Click the button below to download a text file of this lesson's exercises for offline practice.</p>
            <button onclick="downloadWorksheet()" class="btn btn-green text-lg">Export Worksheet (.txt)</button>
        </div>

        <!-- Further Reading Section -->
        <div class="card">
            <h2 class="text-2xl font-bold mb-4">Further Reading & References</h2>
            <p class="mb-4">For more detailed explanations and examples, please visit these reputable online writing resources:</p>
            <ul class="list-disc list-inside space-y-2">
                <li><a href="https://owl.purdue.edu/owl/general_writing/punctuation/end_punctuation/index.html" target="_blank" class="text-blue-600 hover:underline">Purdue OWL: End Punctuation</a></li>
                <li><a href="https://www.grammarly.com/blog/exclamation-mark/" target="_blank" class="text-blue-600 hover:underline">Grammarly Blog: How to Use Exclamation Marks</a></li>
                <li><a href="https://writingcenter.uagc.edu/exclamation-points" target="_blank" class="text-blue-600 hover:underline">University of Arizona Global Campus: The Exclamation Point</a></li>
            </ul>
        </div>
    </div>

    <!-- CHATBOT UI -->
    <div class="fixed bottom-8 right-8 z-[999] flex flex-col items-center">
        <p class="font-semibold text-gray-800 bg-white/90 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg mb-2">TechWrite AI Assistant</p>
        <button id="open-chat-btn" title="Open AI Assistant" class="bg-sky-500 text-white w-16 h-16 rounded-full flex items-center justify-center shadow-lg cursor-pointer transition-transform duration-300 hover:bg-sky-600 hover:scale-110">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10 2a6 6 0 00-6 6v3.586l-1.707 1.707A1 1 0 003 15v1a1 1 0 001 1h12a1 1 0 001-1v-1a1 1 0 00-.293-.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z" />
            </svg>
        </button>
    </div>

    <div id="chat-modal" class="hidden">
        <div class="w-full max-w-2xl h-full sm:h-[80vh] flex flex-col bg-slate-50 rounded-2xl shadow-xl border border-gray-200 transform scale-95 transition-transform duration-300">
            <header class="bg-gradient-to-r from-sky-500 to-indigo-500 text-white text-center p-3 shadow-md rounded-t-2xl flex justify-between items-center">
                <h1 class="text-lg font-bold flex-1 text-center">TechWrite AI Assistant</h1>
                <button id="close-chat-btn" class="text-white hover:bg-white/20 rounded-full p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </header>
            <div id="chat-window" class="flex-1 p-6 space-y-4 overflow-y-auto">
                <div class="chat-bubble bot-bubble p-4 rounded-lg rounded-bl-none">
                    <p class="font-bold text-sky-700">TechWrite Tutor</p>
                    <p class="text-gray-700">Hello! Ask me about the correct use of **exclamation marks** in technical and engineering documents.</p>
                </div>
            </div>
            <div class="p-4 bg-white border-t border-gray-200 rounded-b-2xl">
                <form id="chat-form" class="flex items-center space-x-4">
                    <input id="user-input" type="text" placeholder="e.g., Should I use an exclamation mark in a report?" class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:outline-none" autocomplete="off">
                    <button id="send-btn" type="submit" class="bg-green-500 hover:bg-green-600 text-white font-bold p-3 rounded-lg shadow-md hover:shadow-lg transition-transform duration-200 transform hover:scale-105">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const practiceQuestions = [
            {
                question: "Which sentence uses the exclamation mark correctly for a technical context?",
                options: [
                    "Caution: Wet floor!",
                    "Our profits are up by 15%!",
                    "The new server is very fast!"
                ],
                answer: 0,
                explanation: "Rule 1: The exclamation mark is appropriate here because 'Caution' is a direct warning to the reader."
            },
            {
                question: "Which of these emails is the most professional?",
                options: [
                    "The documents are attached! Let me know if you have any questions!",
                    "The documents are attached. Let me know if you have any questions.",
                    "The documents are attached! Let me know if you have any questions."
                ],
                answer: 1,
                explanation: "Rule 2: For routine business communication, neutral punctuation like a period is the most professional choice. Overuse of exclamation marks can seem unprofessional."
            },
            {
                question: "In which case is an exclamation mark acceptable?",
                options: [
                    "The system is now online.",
                    "Emergency shutdown initiated!",
                    "The report is finished."
                ],
                answer: 1,
                explanation: "Rule 1: An emergency shutdown is an urgent, critical event. An exclamation mark is justified to convey this urgency."
            }
        ];

        const assessmentQuestions = [
            {
                question: "Which sentence is LEAST professional?",
                options: [
                    "Please review the attached schematic.",
                    "I'vecompleted the analysis!",
                    "Warning: Do not operate without safety guards."
                ],
                answer: 1,
                explanation: "Completing an analysis is a routine task. Using an exclamation mark makes it sound overly emotional and unprofessional compared to the neutral statement and the genuine warning."
            },
            {
                question: "Which sentence is punctuated most appropriately?",
                options: [
                    "The pressure levels are nominal!",
                    "Please submit your report by Friday!",
                    "Fire alarm activated! Evacuate immediately!"
                ],
                answer: 2,
                explanation: "A fire alarm and an evacuation order are extremely urgent and command immediate attention. This is a perfect use case for an exclamation mark."
            },
            {
                question: "When is it acceptable to use an exclamation mark in a formal report?",
                options: [
                    "To show excitement about the results.",
                    "To make a point seem more important.",
                    "Almost never, unless quoting a source or for a critical warning in a manual."
                ],
                answer: 2,
                explanation: "In formal technical reports, exclamation marks are extremely rare. Their use is limited to direct safety warnings or when directly quoting someone who used one."
            }
        ];

        const assignmentQuestions = [
            {
                question: "Which of the following is an inappropriate use of an exclamation mark?",
                options: [
                    "Danger! Keep out!",
                    "The data has been compiled!",
                    "Alert! System failure detected!"
                ],
                answer: 1,
                explanation: "Compiling data is a standard procedure. It does not require an exclamation mark, which makes the sentence sound unprofessional."
            },
            {
                question: "A user manual contains the following instruction. Which is best?",
                options: [
                    "Press the red button to stop the machine.",
                    "Press the red button to stop the machine!",
                    "Emergency Stop: Press the red button now!"
                ],
                answer: 2,
                explanation: "The phrase 'Emergency Stop' and the word 'now' convey urgency, justifying the use of an exclamation mark for a critical safety instruction."
            },
            {
                question: "Which sentence is the most professional way to express satisfaction with a result?",
                options: [
                    "The test results were excellent!",
                    "The test results were excellent.",
                    "The test results were excellent!!!"
                ],
                answer: 1,
                explanation: "In professional writing, the adjective 'excellent' is strong enough on its own. A period is the most professional and confident way to end the sentence."
            },
            {
                question: "Your team has just fixed a major bug. What is the most professional way to announce it in a company-wide email?",
                options: [
                    "We fixed the bug!",
                    "Great news! The bug has been fixed!",
                    "The production bug reported this morning has been resolved. The patch is now live."
                ],
                answer: 2,
                explanation: "This option is factual, professional, and provides all necessary information without the unprofessional excitement of exclamation marks."
            }
        ];
        
        let assignmentScore = 0;
        let assignmentAnswered = 0;

        function createMCQSection(containerId, questions, isAssignment = false) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            questions.forEach((q, qIndex) => {
                const qDiv = document.createElement('div');
                let optionsHTML = '';
                q.options.forEach((option, oIndex) => {
                    optionsHTML += `
                        <div class="flex items-center">
                            <input type="radio" id="${containerId}-q${qIndex}o${oIndex}" name="${containerId}-q${qIndex}" value="${oIndex}" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                            <label for="${containerId}-q${qIndex}o${oIndex}" class="ml-3 block text-sm text-gray-900">${option}</label>
                        </div>
                    `;
                });

                qDiv.innerHTML = `
                    <p class="font-medium text-gray-800">${qIndex + 1}. ${q.question}</p>
                    <div id="${containerId}-feedback-q${qIndex}" class="space-y-2 mt-2">${optionsHTML}</div>
                    <div id="${containerId}-explanation-q${qIndex}" class="explanation"></div>
                `;
                container.appendChild(qDiv);

                const optionsContainer = document.getElementById(`${containerId}-feedback-q${qIndex}`);
                optionsContainer.addEventListener('change', (event) => {
                    if(event.target.type === 'radio') {
                        handleMCQSelection(containerId, qIndex, questions, isAssignment);
                    }
                });
            });
        }
        
        function handleMCQSelection(containerId, qIndex, questions, isAssignment) {
            const q = questions[qIndex];
            const feedbackDiv = document.getElementById(`${containerId}-feedback-q${qIndex}`);
            const selectedRadio = feedbackDiv.querySelector(`input[name="${containerId}-q${qIndex}"]:checked`);
            
            if (!selectedRadio) return;

            const userAnswer = parseInt(selectedRadio.value);
            const radios = feedbackDiv.querySelectorAll(`input[name="${containerId}-q${qIndex}"]`);
            
            radios.forEach(radio => {
                radio.disabled = true;
                const label = feedbackDiv.querySelector(`label[for="${radio.id}"]`);
                label.classList.remove('correct-answer', 'incorrect-answer');

                const radioValue = parseInt(radio.value);
                if (radioValue === q.answer) {
                    label.classList.add('correct-answer');
                } else if (radioValue === userAnswer) {
                    label.classList.add('incorrect-answer');
                }
            });

            const explanationDiv = document.getElementById(`${containerId}-explanation-q${qIndex}`);
            if (explanationDiv && q.explanation) {
                explanationDiv.innerHTML = `<b>Explanation:</b> ${q.explanation}`;
                explanationDiv.classList.add('show');
            }

            if(isAssignment) {
                if(!selectedRadio.parentElement.hasAttribute('data-scored')) {
                     if(userAnswer === q.answer) {
                        assignmentScore++;
                    }
                    assignmentAnswered++;
                    radios.forEach(r => r.parentElement.setAttribute('data-scored', 'true'));
                }
                const resultsDiv = document.getElementById('assignment-results');
                resultsDiv.textContent = `Score: ${assignmentScore} out of ${questions.length}`;
            }
        }
        
        function resetSection(containerId, questions, isAssignment = false) {
            if (isAssignment) {
                assignmentScore = 0;
                assignmentAnswered = 0;
                const resultsDiv = document.getElementById('assignment-results');
                resultsDiv.textContent = '';
            }
            createMCQSection(containerId, questions, isAssignment);
        }

        function formatQuestionsForWorksheet(title, questions) {
            let text = `\n\n--- ${title} ---\n\n`;
            text += `Instructions: Choose the sentence where punctuation is used most appropriately and professionally.\n\n`;
            questions.forEach((q, index) => {
                text += `${index + 1}. ${q.question || "Choose the correctly punctuated sentence."}\n`;
                q.options.forEach((opt, optIndex) => {
                    text += `   ${String.fromCharCode(97 + optIndex)}) ${opt}\n`;
                });
                text += '\n';
            });
            return text;
        }

        function downloadWorksheet() {
            let worksheetContent = `Worksheet: Using Exclamation Marks in Technical Writing\n`;
            worksheetContent += `Using A Technology-Enhanced Flipped Classroom Model to Develop EFL Engineering Students’ Punctuation Marks\n`;
            worksheetContent += `=================================================================\n\n`;

            worksheetContent += `** Part 1: Key Rules **\n\n`;
            worksheetContent += `Rule 1: Use for Genuine Warnings and Commands\n- Example: Warning! High voltage.\n\n`;
            worksheetContent += `Rule 2: Avoid Overuse in Professional Communication\n- Example: Unprofessional: The new software update is finally here! vs. Professional: The new software update has been released.\n`;

            worksheetContent += formatQuestionsForWorksheet("Part 2: Practice Questions", practiceQuestions);
            worksheetContent += formatQuestionsForWorksheet("Part 3: Assessment Questions", assessmentQuestions);
            worksheetContent += formatQuestionsForWorksheet("Part 4: Assignment Questions", assignmentQuestions);

            const blob = new Blob([worksheetContent], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'exclamation_marks_worksheet.txt';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }


        document.addEventListener('DOMContentLoaded', () => {
            // Warm-up button
            const revealBtn = document.getElementById('reveal-warmup-btn');
            const warmupExplanation = document.getElementById('warmup-explanation');
            revealBtn.addEventListener('click', () => {
                warmupExplanation.classList.toggle('show');
                revealBtn.textContent = warmupExplanation.classList.contains('show') ? 'Hide Explanation' : 'Reveal Explanation';
            });

            // Drag and Drop Logic
            const exclamation = document.querySelector('.exclamation-draggable');
            const dropZones = document.querySelectorAll('.drop-zone');

            exclamation.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', '!');
            });

            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.classList.add('drag-over');
                });

                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('drag-over');
                });

                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('drag-over');
                    const isCorrect = zone.dataset.correct === 'true';
                    
                    if (zone.textContent === '') { 
                        zone.textContent = e.dataTransfer.getData('text');
                        zone.classList.add(isCorrect ? 'correct' : 'incorrect');
                    }
                });
            });

            createMCQSection('practice-section', practiceQuestions);
            createMCQSection('assessment-section', assessmentQuestions);
            createMCQSection('assignment-section', assignmentQuestions, true);
        });
    </script>
     <!-- --- CHATBOT SCRIPT --- -->
     <script>
        const chatModal = document.getElementById('chat-modal');
        const openChatBtn = document.getElementById('open-chat-btn');
        const closeChatBtn = document.getElementById('close-chat-btn');
        const chatWindow = document.getElementById('chat-window');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');

        const API_MODEL = 'gemini-2.5-flash-preview-05-20';
        const API_KEY = "AIzaSyB8IlKHHSJY28PIs_Zob2d7-HSD6UyXPFo";

        openChatBtn.addEventListener('click', () => {
            chatModal.classList.remove('hidden');
            chatModal.classList.add('visible');
            setTimeout(() => chatModal.querySelector('div').classList.remove('scale-95'), 10);
            userInput.focus();
        });

        closeChatBtn.addEventListener('click', () => {
            chatModal.querySelector('div').classList.add('scale-95');
            chatModal.classList.remove('visible');
             setTimeout(() => chatModal.classList.add('hidden'), 300);
        });

        const SYSTEM_PROMPT = `You are an expert AI tutor named 'TechWrite Tutor', specializing in technical writing for engineering students. You are an assistant for a course page developed by Dr. Mazen Badawy and Dr. Nourhan Adel El-Banna. Your current focus is the lesson page titled "Using Exclamation Marks in Technical Writing."

        **Your Knowledge Base:**

        1.  **Current Lesson:** You are an expert on the two key exclamation mark rules on this page: 1) Use for Genuine Warnings and Commands, and 2) Avoid Overuse in Professional Communication.
        
        2.  **General Technical Writing Guidelines (from your core training):**
            * **Report Structure:** You know the structure of an engineering report (Abstract, Introduction, etc.).
            * **Formal Style:** You must promote formal, objective language. Advise against contractions and clichés. Prefer Latinate verbs (e.g., 'perform' not 'do').
            * **Visuals & Tables:** Remind students that all figures and tables MUST be numbered, titled, and referenced in the text.
            * **Citations:** You must strictly enforce the IEEE citation style when asked.

        **Interaction Rules:**
        * Your tone is encouraging, professional, and clear.
        * When a student asks about exclamation marks, relate your answer directly to the two rules taught in this lesson and provide an engineering-specific example (e.g., "Warning! High voltage.").
        * If a question is about another punctuation mark or topic, briefly answer it but gently guide them back to the main topic of exclamation marks or suggest they visit the homepage for other lessons.
        * Use Markdown (bolding, lists) to format your answers for readability.
        * Do not answer questions outside the scope of technical writing and punctuation.`;
        
        function addMessage(message, sender) {
            const bubble = document.createElement('div');
            bubble.className = `chat-bubble p-4 rounded-lg ${sender === 'user' ? 'user-bubble' : 'bot-bubble'}`;
            let formattedMessage = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
            bubble.innerHTML = `<p>${formattedMessage}</p>`;
            chatWindow.appendChild(bubble);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function toggleTypingIndicator(show) {
            let indicator = document.getElementById('typing-indicator');
            if (show && !indicator) {
                indicator = document.createElement('div');
                indicator.id = 'typing-indicator';
                indicator.className = 'typing-indicator chat-bubble bot-bubble';
                indicator.innerHTML = '<span></span><span></span><span></span>';
                chatWindow.appendChild(indicator);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            } else if (!show && indicator) {
                indicator.remove();
            }
        }
        
        async function handleSendMessage(e) {
            e.preventDefault();
            if (!API_KEY || API_KEY === "YOUR_API_KEY_HERE") {
                 addMessage("The AI Assistant is not configured correctly. Please notify your instructor.", 'bot');
                 return;
            }
            const userMessage = userInput.value.trim();
            if (!userMessage) return;

            addMessage(userMessage, 'user');
            userInput.value = '';
            userInput.disabled = true;
            sendBtn.disabled = true;

            toggleTypingIndicator(true);

            try {
                const botResponse = await callGeminiApi(userMessage);
                addMessage(botResponse, 'bot');
            } catch (error) {
                console.error('API Call Error:', error);
                addMessage('Sorry, I encountered an error. Please try again later.', 'bot');
            } finally {
                toggleTypingIndicator(false);
                userInput.disabled = false;
                sendBtn.disabled = false;
                userInput.focus();
            }
        }

        async function callGeminiApi(userQuery) {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${API_MODEL}:generateContent?key=${API_KEY}`;
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: SYSTEM_PROMPT }] },
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`API Error: ${response.status} ${response.statusText}`);
            }

            const result = await response.json();
            const candidate = result.candidates?.[0];
            if (candidate && candidate.content?.parts?.[0]?.text) {
                return candidate.content.parts[0].text;
            } else {
                if (result.promptFeedback && result.promptFeedback.blockReason) {
                    return `I'm sorry, I can't respond to that for safety reasons: ${result.promptFeedback.blockReason}.`;
                }
                throw new Error('Invalid response structure from API');
            }
        }

        chatForm.addEventListener('submit', handleSendMessage);
    </script>
</body>
</html>

